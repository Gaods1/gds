webpackJsonp([88],{GkLP:function(e,t){},L7wc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("D4TX"),n=a("GOyC"),l=a("8V1Y"),o=a("R5Jg"),s=a("93JQ"),r=a("pxwZ"),d="/system/functions/",p=a("vcD3"),c=a("9pcb"),h={data:function(){var e=this;return{dialogTitle:"",accountAll:[],dialogFormVisible:!1,userDeptCode:null,dept_level:"",serial:"",rules:{dept_name:[{message:"请输入机构部门名称",trigger:["blur","change"],required:!0}],dept_level:[{message:"请输入选择机构部门级别",trigger:["blur","change"],required:!0}],pdept_code:[{message:"请输入选择上级机构部门",trigger:["blur","change"],required:!0}],region_code:[{message:"请输入选择归属地理区域",trigger:["blur","change"],required:!0}],manager_mobile:[{min:11,max:11,message:"请输入正确的手机号码",trigger:["blur","change"],required:!0},{pattern:/^1[3-9]\d{9}$/,message:"请正确输入手机号",trigger:["blur","change"]}],manager:[{min:1,max:32,type:"string",message:"请正确输入管理人员姓名",trigger:["blur","change"],required:!0}]},currentEditLine:0,select_word:"",formData:{},handleType:"new",formBtnList:[{label:"取消",type:"info",show:!1,icon:"",plain:!0,disabled:!1,method:"handleCancle"},{label:"确定",type:"success",icon:"",show:!0,plain:!1,disabled:!1,method:"handleCofirm"}],formOptions:{labelWidth:"120px"},formItems:[{prop:"dept_name",text:"机构部门名称",label:"机构部门名称",type:"input",eleProps:{placeholder:"请输入机构部门名称"}},{prop:"dept_level",text:"机构部门级别",label:"机构部门级别",type:"select",eleProps:{},change:function(t){e.deptLevelChange(t)},options:[{value:2,label:"省级",disabled:!1},{value:3,label:"市级"}]},{prop:"pdept_code",text:"上级机构部门",label:"上级机构部门",type:"select",eleProps:{placeholder:"请先选择机构部门级别"},options:[]},{prop:"region_code",text:"归属地理区域",label:"归属地理区域",type:"selectregion",eleProps:{}},{prop:"manager",text:"管理人姓名",label:"管理人姓名",type:"input",eleProps:{}},{prop:"manager_mobile",text:"管理人手机",label:"管理人手机",type:"input",eleProps:{maxlength:11}},{prop:"addr",text:"机构地址",label:"机构地址",type:"input",eleProps:{}},{prop:"state",text:"机构部门状态",label:"机构部门状态",type:"switch",eleProps:{"inactive-value":0,"active-value":1,"active-text":"启用","inactive-text":"禁用"}},{prop:"dept_memo",text:"机构部门描述",label:"机构部门描述",type:"input",eleProps:{type:"textarea"}}],handleConfig:{searchTerms:[{value:"1",label:"条件一"},{value:"2",label:"条件二"},{value:"3",label:"条件三"}],newItemTxt:"",delBtn:!1,auditBtn:!1},total:0,list:[],columns:[{prop:"dept_name",label:"机构部门名称",align:"center",width:180},{prop:"pdept_code",label:"上级机构部门",align:"center",width:120,formatter:function(e,t,a){return e.pdept}},{prop:"dept_memo",label:"机构部门描述",align:"center",width:120},{prop:"dept_level",label:"机构部门级别",align:"center",width:120,formatter:function(e,t,a){return l.a.deptLevel_arr[e.dept_level]}},{prop:"region_code",label:"归属地理区域",align:"center",width:120,formatter:function(e,t,a){return e.region_name}},{prop:"manager",label:"管理人姓名",align:"center",width:120},{prop:"manager_mobile",label:"管理人手机号",align:"center",width:120},{prop:"addr",label:"机构地址",align:"center",width:120},{prop:"insert_time",label:"创建日期",align:"center",width:180},{prop:"state",label:"状态",align:"center",width:"160",render:function(e,t){return e("el-tag",{props:{type:0===t.row.state?"danger":1===t.row.state?"success":"info"}},0===t.row.state?"禁用":1===t.row.state?"启用":"审核中")}}],operates:{width:200,fixed:"right",list:[{label:"编辑",type:"warning",show:function(e,t){return!0},icon:"el-icon-edit",plain:!0,disabled:!1,method:function(t,a){e.handleEdit(t,a)}},{label:"删除",type:"danger",icon:"el-icon-delete",show:!0,plain:!1,disabled:!1,method:function(t,a){e.handleDel(t,a)}}]},pagination:{pageIndex:1,pageSize:10,show:!0,total:0},options:{stripe:!0,loading:!1,highlightCurrentRow:!0,mutiSelect:!0}}},components:{jsonForm:s.a,curmbs:i.a,handleBox:n.a,opTable:o.a},mounted:function(){this.getLoginDeptDetail()},methods:{deptLevelChange:function(e,t){var a=this;1==e?this.disablePdept=!0:(this.disablePdept=!1,Object(p.d)({params:{dept_level:e-1,echo:!0,dept_code:1==this.dept_level?"":this.userDeptCode}}).then(function(e){e.detail&&a.$message.error(e.detail),a.formItems[2].options.splice(0);for(var i=0;i<e.results.length;i++){var n={};n.value=e.results[i].dept_code,n.label=e.results[i].dept_name,a.formItems[2].options.push(n)}t||(a.formData.pdept_code="")}))},handleOpen:function(){this.$refs.formData.initSelect()},getFuncList:function(){var e,t=this;(e={params:{page:1}},Object(r.b)(d,e)).then(function(e){for(var a in e.detail&&t.$message.error(e.detail),t.funcList=[],e.results){var i={};i.value=e.results[a].func_code,i.label=e.results[a].func_name,t.funcList.push(i)}for(var n in t.formItems)"func_code"==t.formItems[n].prop&&(t.formItems[n].options=t.funcList)})},handleSelectAccount:function(e){},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleClose:function(e){this.$refs.formDialog.$children[0].$refs.formData.clearValidate(),e()},handleCofirm:function(e){var t=this;if(!this.$refs.formData.validateForm())return!1;"edit"==this.handleType?Object(p.c)(this.serial,e).then(function(e){e.detail&&t.$message.error(e.detail),t.list.splice(t.currentEditLine,1,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"编辑成功!"})}):Object(p.a)(e).then(function(e){e.detail&&t.$message.error(e.detail),t.list.splice(0,0,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"添加成功!"})})},newItem:function(){for(var e=0;e<this.formItems.length;e++)this.$set(this.formItems[e].eleProps,"disabled",!1),"switch"==this.formItems[e].type?this.$set(this.formData,this.formItems[e].prop,1):this.$set(this.formData,this.formItems[e].prop,"");this.dialogTitle="新增机构部门",this.currentEditLine=0,this.handleType="new",this.dialogFormVisible=!0},search:function(e,t){this.select_word=t,this.getList()},delAll:function(){console.log("delAll")},getAllAccount:function(){var e=this;Object(c.g)({params:{admin:"True",pageSize:"max"}}).then(function(t){for(var a in t.detail&&e.$message.error(t.detail),e.accountAll=[],t.results){var i=t.results,n={};n.value=i[a].account,n.label=i[a].account,e.accountAll.push(n)}})},getLoginDeptDetail:function(){var e=this;this.userDeptCode=localStorage.getItem("userDetp");var t={dept_code:this.userDeptCode};Object(p.d)({params:t}).then(function(t){t.detail&&e.$message.error(t.detail);var a=t.results[0];e.dept_level=a.dept_level,3!=a.dept_level&&(e.handleConfig.newItemTxt="新增机构部门"),2==a.dept_level&&(console.log(e.formItems[1].options[0]),e.formItems[1].options[0].disabled=!0)})},getList:function(){var e=this;this.options.loading=!0,Object(p.d)({params:{page:this.pagination.pageIndex,page_size:this.pagination.pageSize,search:this.select_word}}).then(function(t){t.detail&&e.$message.error(t.detail),e.total=t.count,e.pagination.total=Number(t.count),e.list=t.results,e.options.loading=!1})},handleSizeChange:function(e){this.pagination=e,this.getList()},handleIndexChange:function(e){this.pagination=e,this.getList()},handleSelectionChange:function(e){console.log("val:",e)},handleEdit:function(e,t){this.currentEditLine=t,this.dialogTitle="编辑机构部门",this.handleType="edit",this.serial=e.serial,this.deptLevelChange(e.dept_level,!0);for(var a=0;a<this.formItems.length;a++)void 0!==e[this.formItems[a].prop]&&(e[this.formItems[a].prop]?this.$set(this.formData,this.formItems[a].prop,e[this.formItems[a].prop]):this.$set(this.formData,this.formItems[a].prop,""));this.dialogFormVisible=!0},handleDel:function(e,t){var a=this;this.$confirm("此操作将永久删除该部门, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(p.b)(e.serial).then(function(e){e.detail&&a.$message.error(e.detail),a.list.splice(t,1)}).then(function(){a.$message({type:"success",message:"删除成功!"})})}).catch(function(e){a.$message({type:"info",message:"已取消删除"})})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"warp-box"},[a("curmbs"),e._v(" "),a("div",{staticClass:"container"},[a("handleBox",{attrs:{handleConfig:e.handleConfig},on:{delAll:e.delAll,search:e.search,newItem:e.newItem}}),e._v(" "),a("opTable",{attrs:{list:e.list,total:e.total,options:e.options,pagination:e.pagination,columns:e.columns,operates:e.operates,getList:e.getList},on:{handleSizeChange:e.handleSizeChange,handleIndexChange:e.handleIndexChange,handleSelectionChange:e.handleSelectionChange}}),e._v(" "),a("el-dialog",{ref:"formDialog",attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"before-close":e.handleClose,modal:!1,"lock-scroll":!0},on:{"update:visible":function(t){e.dialogFormVisible=t},opened:e.handleOpen}},[a("jsonForm",{ref:"formData",attrs:{formBtnList:e.formBtnList,handleType:e.handleType,formData:e.formData,rules:e.rules,formItems:e.formItems,formOptions:e.formOptions},on:{handleCofirm:e.handleCofirm,handleCancle:function(t){e.dialogFormVisible=!1}}})],1)],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(h,m,!1,function(e){a("GkLP")},"data-v-1915c1ea",null);t.default=u.exports}});