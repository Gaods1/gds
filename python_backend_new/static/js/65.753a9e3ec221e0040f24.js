webpackJsonp([65],{gWM8:function(e,t){},xEJa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("a3Yh"),n=a.n(i),s=a("aA9S"),l=a.n(s),r=a("D4TX"),o=a("GOyC"),c=a("R5Jg"),p=a("IkF9"),u=(a("8V1Y"),a("k5wd")),m=a("9pcb"),d={data:function(){var e=this;return{activity_arr:[],accountAll:[],del_selected:[],check_state_arr:{0:"伪删除",1:"通过",2:"不通过",3:"待审核"},signup_check_arr:{1:"是",2:"否"},dialogTitle:"",dialogFormVisible:!1,serial:"",currentEditLine:0,select_word:"",formData:{},handleType:"new",formOptions:{labelWidth:"250px"},formItems:[{prop:"activity_code",text:"活动",label:"活动",$default:null,type:"select",eleProps:{filterable:!0,placeholder:"请选择报名的活动"},options:[],rules:[{required:!0,message:"请选择报名的活动",trigger:"change"}]},{prop:"account_code",text:"报名者帐号",label:"报名者帐号",type:"select",eleProps:{filterable:!0,placeholder:"请选择或搜索"},change:function(t){e.accountCodeChange(t)},options:[],rules:[{required:!0,message:"请选择报名者帐号",trigger:"change"}]},{prop:"signup_name",text:"报名者姓名",label:"报名者姓名",$default:null,type:"input",eleProps:{placeholder:"报名者姓名",maxlength:32},rules:[{required:!0,message:"请填写报名者姓名",trigger:"change"},{min:1,max:32,message:"报名者姓名长度在1到32个字符",trigger:"blur"}]},{prop:"signup_mobile",text:"报名者手机",label:"报名者手机",$default:null,type:"input",eleProps:{placeholder:"报名者手机",maxlength:11},rules:[{required:!0,message:"请填写报名者手机",trigger:"change"},{min:11,max:11,message:"报名者手机11个字符",trigger:"blur"}]},{prop:"verify_code",text:"手机短信验证码",label:"手机短信验证码",$default:null,type:"input",eleProps:{placeholder:"手机短信验证码",maxlength:8},rules:[{min:4,max:8,message:"手机短信验证码4-8个字符",trigger:"blur"}]},{prop:"signup_email",text:"电子邮箱",label:"电子邮箱",$default:null,type:"input",eleProps:{placeholder:"电子邮箱",maxlength:64},rules:[{required:!0,message:"请填写电子邮箱",trigger:"change"},{min:1,max:64,message:"电子邮箱1-64个字符",trigger:"blur"}]},{prop:"company_info",text:"单位信息",label:"单位信息",$default:null,type:"input",eleProps:{placeholder:"单位信息",maxlength:255},rules:[{min:1,max:255,message:"单位信息个字符",trigger:"blur"}]},{prop:"concern_content",text:"比较关注的内容",label:"比较关注的内容",$default:null,type:"editor",defaultValue:"",apiUrl:"",imageShow:!1,eleProps:{maxlength:255},rules:[{required:!0,message:"请填写比较关注的内容",trigger:"change"}]},{prop:"check_state",text:"审核状态",label:"审核状态",$default:null,type:"select",eleProps:{filterable:!0,placeholder:"请选择审核状态"},options:[{value:0,label:"伪删除"},{value:1,label:"通过"},{value:2,label:"不通过"},{value:3,label:"待审核"}],rules:[{required:!0,message:"请选择审核状态",trigger:"change"}]},{prop:"check_time",text:"审核时间",label:"审核时间",$default:null,type:"onlytime",eleProps:{placeholder:"审核时间"}}],handleConfig:{searchTerms:[{value:"signup_name",label:"报名者姓名"}],newItemTxt:"创建报名信息",auditBtn:!1},total:0,list:[],columns:[{prop:"activity_title",label:"活动标题",align:"center",width:180},{prop:"signup_check",label:"活动报名是否需要审核",align:"center",width:180,render:function(t,a){return t("el-tag",{props:{type:2===a.row.signup_check?"info":1===a.row.signup_check?"success":"danger"}},e.signup_check_arr[a.row.signup_check])}},{prop:"signup_name",label:"报名者姓名",align:"center",width:180},{prop:"check_state",label:"审核状态",align:"center",width:"160",render:function(t,a){return t("el-tag",{props:{type:2===a.row.check_state?"danger":1===a.row.check_state?"success":"info"}},e.check_state_arr[a.row.check_state])}},{prop:"signup_mobile",label:"报名者手机",align:"center",width:180},{prop:"verify_code",label:"手机短信验证码",align:"center",width:180},{prop:"signup_email",label:"电子邮箱",align:"center",width:180},{prop:"company_info",label:"单位信息",align:"center",width:180},{prop:"concern_content",label:"比较关注的内容",align:"center",width:180,formatter:function(e,t,a){return e.concern_content}},{prop:"change_num",label:"信息修改次数",align:"center",width:180},{prop:"check_time",label:"审核时间",align:"center",width:180}],operates:{width:300,fixed:"right",list:[{label:"编辑",type:"warning",show:function(e,t){return!0},icon:"el-icon-edit",plain:!0,disabled:!1,method:function(t,a){e.handleEdit(t,a)}},{label:"删除",type:"danger",icon:"el-icon-delete",show:!0,plain:!1,disabled:!1,method:function(t,a){e.handleDel(t,a)}}]},pagination:{pageIndex:1,pageSize:10,show:!0,total:0},options:{stripe:!0,loading:!1,highlightCurrentRow:!0,mutiSelect:!0,index:!0}}},components:{jsonForm:p.a,curmbs:r.a,handleBox:o.a,opTable:c.a},methods:{handleCancle:function(){this.$refs.formData.resetForm(),this.dialogFormVisible=!1},handleClose:function(e){this.$refs.formData.resetForm(),e()},handleOpen:function(){this.$refs.formData.initSelect()},handleCofirm:function(e){var t=this;if(!this.$refs.formData.validateForm())return!1;"edit"==this.handleType?Object(u.A)(this.serial,e).then(function(e){if(e.detail)return t.$message.error(e.detail),!1;t.list.splice(t.currentEditLine,1,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"编辑成功!"}),t.getList()}):Object(u.f)(e).then(function(e){if(e.detail)return t.$message.error(e.detail),!1;t.list.splice(0,0,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"添加成功!"}),t.getList()})},handleEdit:function(e,t){var a=this;this.resetExtrForm(),this.getAllActivity(),this.getAllAccount(),this.currentEditLine=t,this.dialogTitle="编辑活动报名(需审核活动报名编辑会发送短信和邮件通知报名用户 )",this.handleType="edit",this.serial=e.serial,this.dialogFormVisible=!0,this.formData=l()({},e);var i=new Array("account_code","signup_name","signup_mobile","verify_code","company_info","concern_content");this.formItems.forEach(function(t,n){i.includes(t.prop)&&a.$set(t.eleProps,"disabled",!0),"check_state"!=t.prop||2!=a.formData.signup_check&&3==a.formData.check_state||a.$set(t.eleProps,"disabled",!0),t.state&&e[t.prop]&&("picture"!==t.listType?a.forMataAttachList(t.state,a.formData[t.prop],n):a.forMataFileList(t.state,a.formData.face_pic,n)),void 0!==t.defaultValue&&a.$nextTick(function(){a.$set(t,"defaultValue",e[t.prop])})})},forMataAttachList:function(e,t,a){var i=this;if(this.formItems[a].defaultList=[],t.length)for(var s=function(s){var l={};l.response="attachment"==e?n()({},e,[t[s].down]):n()({},e,t[s].down),l.status="success",l.file_caption=t[s].file_caption,l.percentage="100",i.$nextTick(function(){i.formItems[a].defaultList.push(l)})},l=0;l<t.length;l++)s(l)},forMataFileList:function(e,t,a){var i=this,s={};s.response=n()({},e,t),s.status="success",s.percentage="100",this.$nextTick(function(){i.formItems[a].defaultList.splice(0,1,s)})},resetExtrForm:function(){var e=this;this.formItems.forEach(function(t,a){e.$set(t.eleProps,"disabled",!1),e.$set(e.formData,t.prop,t.$default),t.state&&(t.defaultList=[]),void 0!==t.defaultValue&&e.$nextTick(function(){t.defaultValue=null})})},accountCodeChange:function(e){var t=this,a={admin:"False",account_code:e};Object(m.g)({params:a}).then(function(e){e.detail&&t.$message.error(e.detail);var a=e.results[0];for(var i in t.formItems)"signup_name"==t.formItems[i].prop&&null!=a.user_name?(t.$set(t.formData,t.formItems[i].prop,a.user_name),t.$set(t.formItems[i].eleProps,"disabled",!0)):"signup_name"==t.formItems[i].prop&&null==a.user_name&&(t.$set(t.formItems[i].eleProps,"disabled",!1),t.$set(t.formData,t.formItems[i].prop,"")),"signup_mobile"==t.formItems[i].prop&&null!=a.user_mobile?(t.$set(t.formData,t.formItems[i].prop,a.user_mobile),t.$set(t.formItems[i].eleProps,"disabled",!0)):"signup_mobile"==t.formItems[i].prop&&null==a.user_mobile&&(t.$set(t.formItems[i].eleProps,"disabled",!1),t.$set(t.formData,t.formItems[i].prop,"")),"signup_email"==t.formItems[i].prop&&null!=a.user_email?(t.$set(t.formData,t.formItems[i].prop,a.user_email),t.$set(t.formItems[i].eleProps,"disabled",!0)):"signup_email"==t.formItems[i].prop&&null==a.user_email&&(t.$set(t.formItems[i].eleProps,"disabled",!1),t.$set(t.formData,t.formItems[i].prop,""))})},getAllActivity:function(){var e=this;Object(u.C)({params:{page_size:"max"}}).then(function(t){for(var a in t.detail&&e.$message.error(t.detail),e.activity_arr=[],t.results)t.results[a].state>=1&&t.results[a].state<=5&&e.activity_arr.push({value:t.results[a].activity_code,label:t.results[a].activity_title});for(var a in e.formItems)"activity_code"==e.formItems[a].prop&&e.$set(e.formItems[a],"options",e.activity_arr)})},newItem:function(){this.resetExtrForm(),this.dialogTitle="新增活动报名",this.currentEditLine=0,this.handleType="new",this.dialogFormVisible=!0,this.getAllActivity(),this.getAllAccount()},search:function(e,t){this.select_word=t,this.pagination.pageIndex=1,this.getList()},getAllAccount:function(){var e=this;Object(m.g)({params:{admin:"False",page_size:"max",state:1}}).then(function(t){for(var a in t.detail&&e.$message.error(t.detail),e.accountAll=[],t.results){var i=t.results,n={};n.value=i[a].account_code,n.label=i[a].user_name,e.accountAll.push(n)}for(var s in e.formItems)"account_code"==e.formItems[s].prop&&(e.formItems[s].options=e.accountAll)})},getList:function(){var e=this;this.options.loading=!0,Object(u.I)({params:{page:this.pagination.pageIndex,page_size:this.pagination.pageSize,search:this.select_word}}).then(function(t){t.detail&&e.$message.error(t.detail),e.total=t.count,e.pagination.total=Number(t.count),e.list=t.results,e.options.loading=!1})},handleSizeChange:function(e){this.pagination=e,this.getList()},handleIndexChange:function(e){this.pagination=e,this.getList()},handleSelectionChange:function(e){var t=new Array;for(var a in e)t.push(e[a].serial);this.del_selected=t},handleDetail:function(e,t){this.$router.push({name:"activity_detail",query:{serial:e.serial}})},handleDel:function(e,t){var a=this;this.$confirm("此操作将删除该活动报名是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(u.t)(e.serial).then(function(e){a.list.splice(t,1)}).then(function(){a.$message({type:"success",message:"删除成功!"})})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},delAll:function(){var e=this;if(0==this.del_selected.length)return this.$message({type:"error",message:"请选择要批量删除的活动报名!"}),!1;var t=this.del_selected.shift();Object(u.n)(t,{data:this.del_selected}).then(function(t){if(t.detail)return e.$message.error(t.detail),!1;e.dialogFormVisible=!1,e.$message({type:"success",message:"批量删除成功!",duration:500,onClose:function(){window.location.reload()}})})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"warp-box"},[a("curmbs"),e._v(" "),a("div",{staticClass:"container"},[a("handleBox",{attrs:{handleConfig:e.handleConfig},on:{delAll:e.delAll,search:e.search,newItem:e.newItem}}),e._v(" "),a("opTable",{attrs:{list:e.list,total:e.total,options:e.options,pagination:e.pagination,columns:e.columns,operates:e.operates,getList:e.getList},on:{handleSizeChange:e.handleSizeChange,handleIndexChange:e.handleIndexChange,handleSelectionChange:e.handleSelectionChange}}),e._v(" "),a("el-dialog",{ref:"formDialog",attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"before-close":e.handleClose,modal:!1,"lock-scroll":!0},on:{"update:visible":function(t){e.dialogFormVisible=t},opened:e.handleOpen}},[a("jsonForm",{ref:"formData",attrs:{handleType:e.handleType,formData:e.formData,formItems:e.formItems,formOptions:e.formOptions},on:{handleCancle:e.handleCancle,handleCofirm:e.handleCofirm}})],1)],1)],1)},staticRenderFns:[]};var g=a("C7Lr")(d,h,!1,function(e){a("gWM8")},"data-v-c6ba354a",null);t.default=g.exports}});