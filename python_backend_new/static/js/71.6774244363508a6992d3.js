webpackJsonp([71],{"3Z30":function(e,t){},Gmxu:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("a3Yh"),n=i.n(a),l=i("aA9S"),s=i.n(l),r=i("D4TX"),o=i("GOyC"),c=i("R5Jg"),d=i("IkF9"),h=(i("8V1Y"),i("k5wd")),u={data:function(){var e=this;return{activity_code:this.$route.query.activity_code,activity_start_time:"",activity_end_time:"",activity_arr:[],del_selected:[],state_arr:{1:"正常",2:"禁用"},type_arr:{1:"线上",2:"线下"},dialogTitle:"",dialogFormVisible:!1,serial:"",currentEditLine:0,select_word:"",formData:{},handleType:"new",formOptions:{labelWidth:"250px"},formItems:[{prop:"activity_code",text:"活动",label:"活动",$default:null,type:"select",eleProps:{filterable:!0,placeholder:"请选择创建抽奖的活动"},options:[],rules:[{required:!0,message:"请选择创建抽奖的活动",trigger:"change"}]},{prop:"type",text:"抽奖形式",label:"抽奖形式",$default:null,type:"select",eleProps:{filterable:!0,placeholder:"请选择抽奖形式"},options:[{value:1,label:"线上"},{value:2,label:"线下"}],rules:[{required:!0,message:"请选择抽奖形式",trigger:"change"}]},{prop:"lottery_title",text:"抽奖标题",label:"抽奖标题",$default:null,type:"input",eleProps:{placeholder:"抽奖标题",maxlength:50},rules:[{required:!0,message:"请输入抽奖标题",trigger:"change"},{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]},{prop:"start_time",text:"抽奖开始时间",label:"抽奖开始时间",$default:null,type:"onlytime",eleProps:{placeholder:"抽奖开始时间"},rules:[{required:!0,message:"请选择抽奖开始时间",trigger:"change"}]},{prop:"end_time",text:"抽奖结束时间",label:"抽奖结束时间",$default:null,type:"onlytime",eleProps:{placeholder:"抽奖结束时间"},rules:[{required:!0,message:"请选择抽奖结束时间",trigger:"change"}]},{prop:"lottery_num",text:"每次抽奖次数",label:"每次抽奖次数",$default:null,type:"input",eleProps:{placeholder:"每次抽奖允许抽奖的次数",maxlength:10}},{prop:"state",text:"抽奖状态",label:"抽奖状态",$default:null,type:"select",eleProps:{filterable:!0,placeholder:"请选择抽奖状态"},options:[{value:1,label:"正常"},{value:2,label:"禁用"}],rules:[{required:!0,message:"请选择抽奖状态",trigger:"change"}]}],handleConfig:{searchTerms:[{value:"",label:""}],newItemTxt:"创建抽奖",auditBtn:!1},total:0,list:[],columns:[{prop:"activity_title",label:"活动标题",align:"center",width:180},{prop:"type",label:"抽奖形式",align:"center",width:"160",render:function(t,i){return t("el-tag",{props:{type:2===i.row.type?"danger":1===i.row.type?"success":"info"}},e.type_arr[i.row.type])}},{prop:"lottery_title",label:"抽奖标题",align:"center",width:180},{prop:"start_time",label:"抽奖开始时间",align:"center",width:180},{prop:"end_time",label:"抽奖结束时间",align:"center",width:180},{prop:"lottery_num",label:"每次抽奖次数",align:"center",width:180},{prop:"state",label:"抽奖状态",align:"center",width:"160",render:function(t,i){return t("el-tag",{props:{type:2===i.row.state?"danger":1===i.row.state?"success":"info"}},e.state_arr[i.row.state])}},{prop:"insert_time",label:"创建时间",align:"center",width:180}],operates:{width:300,fixed:"right",list:[{label:"奖品管理",type:"primary",show:function(e,t){return!0},icon:"el-icon-info",plain:!0,disabled:!1,method:function(t,i){e.handlePrize(t,i)}},{label:"中奖统计",type:"primary",show:function(e,t){return!0},icon:"el-icon-info",plain:!0,disabled:!1,method:function(t,i){e.handleWin(t,i)}},{label:"编辑",type:"warning",show:function(e,t){return!0},icon:"el-icon-edit",plain:!0,disabled:!1,method:function(t,i){e.handleEdit(t,i)}},{label:"删除",type:"danger",icon:"el-icon-delete",show:!0,plain:!1,disabled:!1,method:function(t,i){e.handleDel(t,i)}}]},pagination:{pageIndex:1,pageSize:10,show:!0,total:0},options:{stripe:!0,loading:!1,highlightCurrentRow:!0,mutiSelect:!0,index:!0}}},components:{jsonForm:d.a,curmbs:r.a,handleBox:o.a,opTable:c.a},methods:{handleCancle:function(){this.$refs.formData.resetForm(),this.dialogFormVisible=!1},handleClose:function(e){this.$refs.formData.resetForm(),e()},handleOpen:function(){this.$refs.formData.initSelect()},handleCofirm:function(e){var t=this;if(!this.$refs.formData.validateForm())return!1;"edit"==this.handleType?Object(h.y)(this.serial,e).then(function(e){t.list.splice(t.currentEditLine,1,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"编辑成功!"}),t.getList()}):Object(h.d)(e).then(function(e){t.list.splice(0,0,e),t.dialogFormVisible=!1,t.$message({type:"success",message:"添加成功!"}),t.getList()})},handleEdit:function(e,t){var i=this;this.resetExtrForm(),this.getAllActivity(),this.currentEditLine=t,this.dialogTitle="编辑抽奖",this.handleType="edit",this.serial=e.serial,this.dialogFormVisible=!0,this.formData=s()({},e),this.formItems.forEach(function(t,a){t.state&&e[t.prop]&&("picture"!==t.listType?i.forMataAttachList(t.state,i.formData[t.prop],a):i.forMataFileList(t.state,i.formData.face_pic,a)),void 0!==t.defaultValue&&i.$nextTick(function(){i.$set(t,"defaultValue",e[t.prop])})})},forMataAttachList:function(e,t,i){var a=this;if(this.formItems[i].defaultList=[],t.length)for(var l=function(l){var s={};s.response="attachment"==e?n()({},e,[t[l].down]):n()({},e,t[l].down),s.status="success",s.file_caption=t[l].file_caption,s.percentage="100",a.$nextTick(function(){a.formItems[i].defaultList.push(s)})},s=0;s<t.length;s++)l(s)},forMataFileList:function(e,t,i){var a=this,l={};l.response=n()({},e,t),l.status="success",l.percentage="100",this.$nextTick(function(){a.formItems[i].defaultList.splice(0,1,l)})},resetExtrForm:function(){var e=this;this.formItems.forEach(function(t,i){e.$set(e.formData,t.prop,t.$default),t.state&&(t.defaultList=[]),void 0!==t.defaultValue&&e.$nextTick(function(){t.defaultValue=null})})},getAllActivity:function(){var e=this;Object(h.C)({params:{activity_code:this.activity_code,pageSize:"max"}}).then(function(t){for(var i in e.activity_arr=[],e.$set(e,"activity_start_time",t.data.results[0].activity_start_time),e.$set(e,"activity_end_time",t.data.results[0].activity_end_time),t.data.results)e.activity_arr.push({value:t.data.results[i].activity_code,label:t.data.results[i].activity_title});for(var i in e.formItems)"activity_code"==e.formItems[i].prop&&(e.$set(e.formItems[i],"options",e.activity_arr),e.formData.activity_code=t.data.results[0].activity_code)})},newItem:function(){this.resetExtrForm(),this.currentEditLine=0,this.dialogTitle="新增抽奖(活动时间:"+this.activity_start_time+"~"+this.activity_end_time+")",this.handleType="new",this.dialogFormVisible=!0,this.getAllActivity()},search:function(e,t){this.select_word=t,this.pagination.pageIndex=1,this.getList()},getList:function(){var e=this;this.options.loading=!0,Object(h.G)({params:{activity_code:this.activity_code,page:this.pagination.pageIndex,page_size:this.pagination.pageSize,search:this.select_word}}).then(function(t){e.total=t.data.count,e.pagination.total=Number(t.data.count),e.list=t.data.results,e.options.loading=!1}),Object(h.C)({params:{activity_code:this.activity_code,pageSize:"max"}}).then(function(t){t.data.results[0].state>=6&&(e.handleConfig.newItemTxt=!1),e.activity_start_time=t.data.results[0].activity_start_time,e.activity_end_time=t.data.results[0].activity_end_time})},handleSizeChange:function(e){this.pagination=e,this.getList()},handleIndexChange:function(e){this.pagination=e,this.getList()},handleSelectionChange:function(e){var t=new Array;for(var i in e)t.push(e[i].serial);this.del_selected=t},handlePrize:function(e,t){this.$router.push({name:"activity_prize",query:{activity_code:e.activity_code,lottery_code:e.lottery_code}})},handleWin:function(e,t){this.$router.push({name:"activity_winner",query:{activity_code:e.activity_code,lottery_code:e.lottery_code}})},handleDel:function(e,t){var i=this;this.$confirm("此操作将删除该抽奖是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(h.r)(e.serial).then(function(e){i.list.splice(t,1)}).then(function(){i.$message({type:"success",message:"删除成功!"})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})},delAll:function(){var e=this;if(0==this.del_selected.length)return this.$message({type:"error",message:"请选择要批量删除的抽奖!"}),!1;var t=this.del_selected.shift();Object(h.l)(t,{data:this.del_selected}).then(function(t){e.dialogFormVisible=!1,e.$message({type:"success",message:"批量删除成功!",duration:500,onClose:function(){window.location.reload()}})})}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"warp-box"},[i("curmbs"),e._v(" "),i("div",{staticClass:"container"},[i("handleBox",{attrs:{handleConfig:e.handleConfig},on:{delAll:e.delAll,search:e.search,newItem:e.newItem}}),e._v(" "),i("opTable",{attrs:{list:e.list,total:e.total,options:e.options,pagination:e.pagination,columns:e.columns,operates:e.operates,getList:e.getList},on:{handleSizeChange:e.handleSizeChange,handleIndexChange:e.handleIndexChange,handleSelectionChange:e.handleSelectionChange}}),e._v(" "),i("el-dialog",{ref:"formDialog",attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"before-close":e.handleClose,modal:!1,"lock-scroll":!0},on:{"update:visible":function(t){e.dialogFormVisible=t},opened:e.handleOpen}},[i("jsonForm",{ref:"formData",attrs:{handleType:e.handleType,formData:e.formData,formItems:e.formItems,formOptions:e.formOptions},on:{handleCancle:e.handleCancle,handleCofirm:e.handleCofirm}})],1)],1)],1)},staticRenderFns:[]};var f=i("C7Lr")(u,p,!1,function(e){i("3Z30")},"data-v-7b4bc591",null);t.default=f.exports}});